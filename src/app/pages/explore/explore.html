<div class="min-h-screen bg-gray-50">
  <!-- Header - Fixed height -->
  <div class="bg-white shadow-sm border-b">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <img src="/logo.svg" alt="ETZ Logo" class="h-12">
          <h1 class="text-2xl font-bold text-blue-600">Loopbaanpaden Verkenner</h1>
          <select (change)="changeLayout($event)"
            class="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="grid">Grid</option>
            <option value="breadthfirst">Hierarchisch</option>
            <option value="cose">Relatief</option>

          </select>
        </div>
        <button routerLink="/landing"
          class="cursor-pointer bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
          Terug naar Home
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content - Fill remaining space -->
  <div class="flex h-[calc(100vh-80px)]">
    <!-- Left Panel - Fixed width -->
    <div class="w-[30%] bg-white border-r border-gray-200 overflow-y-auto">
      <!-- Search and Filter Section -->
      <div class="p-4 border-b border-gray-200 space-y-4">
        <!-- Search box -->
        <div class="bg-white p-4 rounded-lg border-2 border-blue-400 shadow-lg">
          <label class="block text-sm font-semibold text-blue-900 mb-2">
            üîç Start hier je verkenning
          </label>
          <div class="relative">
            <input type="text" [(ngModel)]="searchQuery" (input)="onSearch($event)" placeholder="Zoek een functie..."
              class="w-full px-4 py-3 border-2 border-blue-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base font-medium">
            @if (searchResults.length > 0) {
            <div class="absolute z-10 w-full mt-1 bg-white border-2 border-blue-300 rounded-lg shadow-xl">
              @for (result of searchResults; track result.id) {
              <button (click)="selectSearchResult(result)"
                class="w-full px-4 py-3 text-left hover:bg-blue-50 text-sm font-medium border-b last:border-b-0">
                {{ result.label }}
              </button>
              }
            </div>
            }
          </div>
        </div>

        <!-- Filters -->
        <div class="space-y-3">
          <h3 class="font-medium text-gray-700">Filters</h3>

          <!-- Department filter -->
          <div>
            <label for="department" class="block text-sm text-gray-600 mb-1">Afdeling</label>
            <select id="department" [(ngModel)]="selectedDepartment" (change)="applyFilters()"
              class="w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Alle afdelingen</option>
              @for (dept of departments; track dept) {
              <option [value]="dept">{{ dept }}</option>
              }
            </select>
          </div>

          <!-- Care/non care filter -->
          <div>
            <label for="careType" class="block text-sm text-gray-600 mb-1">Care/non care</label>
            <select id="careType" [(ngModel)]="selectedCareType" (change)="applyFilters()"
              class="w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Alle types</option>
              @for (careType of careTypes; track careType) {
              <option [value]="careType">{{ careType }}</option>
              }
            </select>
          </div>

          <!-- Care cluster filter -->
          <div>
            <label for="careCluster" class="block text-sm text-gray-600 mb-1">Care cluster</label>
            <select id="careCluster" [(ngModel)]="selectedCareCluster" (change)="applyFilters()"
              class="w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Alle clusters</option>
              @for (cluster of careClusters; track cluster) {
              <option [value]="cluster">{{ cluster }}</option>
              }
            </select>
          </div>

          <!-- Salary filter - moved to bottom -->
          <div>
            <label for="salary" class="block text-sm text-gray-600 mb-1">Salarisschaal</label>
            <select id="salary" [(ngModel)]="selectedSalaryLevel" (change)="applyFilters()"
              class="w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">Alle salarisschalen</option>
              @for (salary of salaryLevels; track salary) {
              <option [value]="salary">{{ salary }}</option>
              }
            </select>
          </div>

          <!-- Reset filters button -->
          @if (selectedDepartment || selectedSalaryLevel || selectedCareType || selectedCareCluster) {
          <button (click)="resetFilters()"
            class="w-full px-3 py-2 text-sm text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 transition-colors">
            Filters wissen
          </button>
          }
        </div>
      </div>

      <div class="p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">Functiedetails</h2>

        @if (!selectedNode) {
        <div class="text-center py-8">
          <div class="text-gray-400 text-5xl mb-4">üëÜ</div>
          <p class="text-gray-600">Klik op een knop in de grafiek om gedetailleerde informatie te bekijken.</p>
        </div>
        } @else {
        <div class="space-y-4">
          <div class="bg-blue-50 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-blue-600 mb-2">
              {{ selectedNode.label }}
            </h3>
            <div class="space-y-2 text-sm">
              <p><span class="font-medium">Afdeling:</span> {{ selectedNode.department }}</p>
              <p><span class="font-medium">Niveau:</span> {{ selectedNode.level }}</p>
            </div>
          </div>

          <div>
            <h4 class="font-medium text-gray-800 mb-2">Omschrijving</h4>
            <p class="text-gray-600 text-sm">{{ selectedNode.description }}</p>
          </div>

          <div>
            <h4 class="font-medium text-gray-800 mb-2">Vereisten</h4>
            <p class="text-sm text-gray-600">{{ selectedNode.requirements }}</p>
          </div>

          <!-- Care/non care -->
          @if (selectedNode.careNonCare) {
          <div>
            <h4 class="font-medium text-gray-800 mb-2">Care/non care</h4>
            <p class="text-sm text-gray-600">{{ selectedNode.careNonCare }}</p>
          </div>
          }

          <!-- Care cluster -->
          @if (selectedNode.careCluster) {
          <div>
            <h4 class="font-medium text-gray-800 mb-2">Care cluster</h4>
            <p class="text-sm text-gray-600">{{ selectedNode.careCluster }}</p>
          </div>
          }

          <!-- Werkenbij link -->
          @if (selectedNode.werkenbijlink) {
          <div>
            <h4 class="font-medium text-gray-800 mb-2">Meer informatie</h4>
            <a [href]="selectedNode.werkenbijlink" target="_blank" rel="noopener noreferrer"
              class="text-sm text-blue-600 hover:text-blue-800 underline flex items-center gap-1">
              Bekijk vacature op werkenbij.etz.nl
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
              </svg>
            </a>
          </div>
          }

          <!-- PIO link -->
          @if (selectedNode.pioLink) {
          <div>
            <h4 class="font-medium text-gray-800 mb-2">PIO informatie</h4>
            <a [href]="selectedNode.pioLink" target="_blank" rel="noopener noreferrer"
              class="text-sm text-blue-600 hover:text-blue-800 underline flex items-center gap-1">
              Werken en leren als PIO
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
              </svg>
            </a>
          </div>
          }

          <!-- Career paths section -->
          @if (selectedNodePaths.length > 0) {
          <div>
            <h4 class="font-medium text-gray-800 mb-2">Loopbaanmogelijkheden</h4>
            <div class="space-y-3">
              @for (path of selectedNodePaths; track path.to) {
              <div (click)="selectNodeById(path.to)"
                class="bg-gray-50 p-3 rounded-lg text-sm cursor-pointer hover:bg-gray-100 transition-colors">
                <div class="flex items-center justify-between mb-1">
                  <span class="font-medium text-blue-600">{{ getNodeLabel(path.to) }}</span>
                  <span class="text-gray-500 text-xs">{{ path.timeframe }}</span>
                </div>
                <p class="text-gray-600">Mogelijke vervolgstap</p>
              </div>
              }
            </div>
          </div>
          }
        </div>
        }
      </div>
    </div>

    <!-- Right Panel - Graph area -->
    <div class="w-[70%] relative overflow-hidden">
      <!-- Cytoscape Container -->
      <div #cytoscapeContainer class="w-full h-full" style="overflow: hidden;"></div>

      <!-- Control buttons -->
      <div class="absolute top-4 right-4 space-y-2">
        <button (click)="resetView()" class="bg-white shadow-md px-3 py-2 rounded-lg text-sm hover:bg-gray-50 w-full">
          Herstel Weergave
        </button>
        <button (click)="toggleNodeLabels()"
          class="bg-white shadow-md px-3 py-2 rounded-lg text-sm hover:bg-gray-50 w-full">
          {{ showLabels ? 'Verberg' : 'Toon' }} Labels
        </button>
      </div>

      <!-- Back Navigation Button -->
      @if (canGoBack()) {
      <button (click)="goBack()"
        class="absolute top-4 left-4 bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg shadow-md border border-gray-300 transition-all flex items-center gap-2 cursor-pointer">
        <span class="text-lg">‚Üê</span>
        <span class="font-medium">Vorige</span>
        <span class="text-xs text-gray-500">({{ navigationHistory.length - 1 }})</span>
      </button>
      }

      <!-- Zoom Controls -->
      <div class="absolute bottom-4 right-4 bg-white shadow-md rounded-lg p-2 space-y-2">
        <button (click)="zoomIn()" title="Zoom in (+ toets)"
          class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
        </button>
        <div class="text-center text-sm text-gray-600">
          {{ currentZoomLevel }}%
        </div>
        <button (click)="zoomOut()" title="Zoom uit (- toets)"
          class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
          </svg>
        </button>
      </div>

      <!-- Help Tips -->
      <div class="absolute bottom-4 left-4 bg-white/90 shadow-md rounded-lg p-3 text-xs text-gray-600 help-tips">
        <div class="font-semibold mb-1">Tips:</div>
        <div class="space-y-0.5">
          <div>‚Ä¢ Hover over een knop voor details</div>
          <div>‚Ä¢ Klik voor volledige informatie</div>
          <div>‚Ä¢ Scroll voor zoom (+/- toetsen)</div>
          <div>‚Ä¢ R = Herstel weergave</div>
          <div>‚Ä¢ L = Toggle labels</div>
        </div>
      </div>

      <!-- Zoom notification -->
      @if (currentZoomLevel < 50) { <div
        class="absolute top-20 left-1/2 transform -translate-x-1/2 bg-yellow-100 border border-yellow-400 rounded-lg px-4 py-2 text-sm text-yellow-800 zoom-notification">
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>Zoom in of hover over knoppen om labels te lezen</span>
        </div>
    </div>
    }

    <!-- Hover Tooltip -->
    @if (showTooltip && hoveredNode) {
    <div class="absolute bg-white rounded-lg shadow-xl border border-gray-200 p-4 z-40 pointer-events-none"
      [style.left.px]="tooltipPosition.x" [style.top.px]="tooltipPosition.y"
      style="max-width: 300px; transform: translate(-50%, calc(-100% - 10px));">
      <div class="space-y-2">
        <h4 class="font-semibold text-blue-600">{{ hoveredNode.label }}</h4>
        <div class="text-sm text-gray-600 space-y-1">
          <p><span class="font-medium">Afdeling:</span> {{ hoveredNode.department }}</p>
          <p><span class="font-medium">Niveau:</span> {{ hoveredNode.level }}</p>
          <p><span class="font-medium">Salaris:</span> {{ hoveredNode.salary }}</p>
        </div>
        <p class="text-sm text-gray-700 mt-2">{{ hoveredNode.description }}</p>
        <p class="text-xs text-gray-500 mt-2 italic">Klik voor meer details</p>
      </div>
    </div>
    }

    <!-- Welcome Screen Overlay -->
    @if (showWelcome) {
    <div class="absolute inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-8">
        <h2 class="text-2xl font-bold text-blue-600 mb-4">Welkom bij de Loopbaanpaden Verkenner</h2>

        <div class="space-y-6">
          <!-- Usage Instructions -->
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold text-blue-900 mb-2">Hoe te gebruiken:</h3>
            <ul class="text-sm text-gray-700 space-y-2">
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">‚Ä¢</span>
                <span>Gebruik de <strong>zoekfunctie</strong> bovenaan om een specifieke functie te vinden</span>
              </li>
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">‚Ä¢</span>
                <span>Gebruik de <strong>filters</strong> om functies te filteren op afdeling, care cluster, etc.</span>
              </li>
              <li class="flex items-start">
                <span class="text-blue-600 mr-2">‚Ä¢</span>
                <span><strong>Klik op een functie</strong> in de grafiek om details te zien en loopbaanpaden te
                  ontdekken</span>
              </li>
            </ul>
          </div>

          <!-- Quick Start Examples -->
          <div>
            <p class="text-gray-700 mb-3">Of klik op onderstaande functies voor een startpunt:</p>

            <div class="grid grid-cols-2 gap-3">
              @if (currentFamily === 'care') {
              <button (click)="selectQuickStartFunction('MBO-verpleegkundige')"
                class="p-4 border-2 border-blue-200 rounded-lg text-left hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group">
                <h4 class="font-semibold text-blue-700 group-hover:text-blue-800">MBO-verpleegkundige</h4>
                <p class="text-xs text-gray-600 mt-1">Zorg niveau C/B</p>
              </button>

              <button (click)="selectQuickStartFunction('HBO-verpleegkundige')"
                class="p-4 border-2 border-blue-200 rounded-lg text-left hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group">
                <h4 class="font-semibold text-blue-700 group-hover:text-blue-800">HBO-verpleegkundige</h4>
                <p class="text-xs text-gray-600 mt-1">Verpleegkundige A</p>
              </button>

              <button (click)="selectQuickStartFunction('IC verpleegkundige')"
                class="p-4 border-2 border-blue-200 rounded-lg text-left hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group">
                <h4 class="font-semibold text-blue-700 group-hover:text-blue-800">IC-verpleegkundige</h4>
                <p class="text-xs text-gray-600 mt-1">Intensive Care</p>
              </button>

              <button (click)="selectQuickStartFunction('Afdelingsassistent')"
                class="p-4 border-2 border-blue-200 rounded-lg text-left hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group">
                <h4 class="font-semibold text-blue-700 group-hover:text-blue-800">Afdelingsassistent</h4>
                <p class="text-xs text-gray-600 mt-1">Ondersteunende zorg</p>
              </button>

              <button (click)="selectQuickStartFunction('Zorgassistent')"
                class="p-4 border-2 border-blue-200 rounded-lg text-left hover:border-blue-500 hover:bg-blue-50 transition-all cursor-pointer group">
                <h4 class="font-semibold text-blue-700 group-hover:text-blue-800">Zorgassistent</h4>
                <p class="text-xs text-gray-600 mt-1">Basis zorgverlening</p>
              </button>
              }

              <button (click)="showWelcome = false"
                class="p-4 border-2 border-gray-200 rounded-lg text-left hover:border-gray-400 hover:bg-gray-50 transition-all cursor-pointer group">
                <h4 class="font-semibold text-gray-700 group-hover:text-gray-800">Zelf verkennen</h4>
                <p class="text-xs text-gray-600 mt-1">Start zonder voorbeeld</p>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>